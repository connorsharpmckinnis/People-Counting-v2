version: "3.8"

services:
  detection-engine:
    # Build from the Dockerfile in this directory
    build: .
    image: connorsharpmckinnis/detection-engine:0.9
    
    # Container name for easy reference
    container_name: detection-engine
    
    # Environment variables
    # You can also use an .env file alongside this compose file
    environment:
      - APP_PASSWORD=apex123
      - NUM_WORKERS=3
    
    # Persist data across container restarts
    volumes:
      - ./data:/app/data         # jobs.db lives here
      - ./results:/app/results   # Annotated output files
      - ./uploads:/app/uploads   # Temporary uploaded files
      - ./models:/app/models     # YOLO models folder
      
    # Expose the port
    ports:
      - "8000:8000"
    
    # Restart if it crashes
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  